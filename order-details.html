<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>

   <style>
 body {
  margin: 0;
  font-family: "Tahoma", sans-serif;
  background: linear-gradient(135deg, #efebe9, #d7ccc8);
  color: #4e342e;
  padding: 20px;
  line-height: 1.8;
}

header {
  background: linear-gradient(90deg, #6d4c41, #8d6e63);
  color: #fff;
  text-align: center;
  padding: 25px;
  border-radius: 0 0 20px 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

main {
  max-width: 900px;
  margin: 30px auto;
  background: #fffaf5;
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}

.back-btn, .remove-btn {
  display: inline-block;
  width: 200px;
  padding: 15px;
  font-size: 18px;
  font-weight: bold;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  margin: 20px 10px;
  background: linear-gradient(90deg, #5d4037, #8d6e63);
  color: #fff;
  box-shadow: 0 6px 20px rgba(93,64,55,0.4);
  transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
}

/* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ */
.back-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 10px 30px rgba(93,64,55,0.6);
  background: linear-gradient(90deg, #4e342e, #6d4c41);
}

/* Ø²Ø± Ø§Ù„Ø­Ø°Ù */
.remove-btn {
  background: linear-gradient(90deg, #c62828, #e53935);
}
.remove-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 10px 30px rgba(183,28,28,0.6);
  background: linear-gradient(90deg, #b71c1c, #d32f2f);
}

.product-list {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-top: 20px;
  justify-content: center;
}

.product-item {
  background: #fff8e1;
  border: 1px solid #ffcc80;
  border-radius: 20px;
  padding: 15px;
  text-align: center;
  width: 180px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  opacity: 0;
  animation: fadeUp 0.8s ease forwards;
}

.product-item:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 10px 25px rgba(255,111,0,0.4);
}

.product-item img {
  width: 150px;
  height: 150px;
  object-fit: cover;
  border-radius: 15px;
  margin-bottom: 10px;
  transition: transform 0.4s ease;
}

.product-item:hover img {
  transform: scale(1.08);
}

.product-item p {
  margin: 5px 0;
  font-size: 14px;
  color: #5d4037;
}

.total-price {
  margin-top: 25px;
  font-weight: bold;
  font-size: 22px;
  color: #2e7d32;
  text-align: center;
}

/* Toast */
.toast {
  visibility: hidden;
  min-width: 250px;
  background: linear-gradient(90deg, #4caf50, #2e7d32);
  color: #fff;
  text-align: center;
  border-radius: 30px;
  padding: 16px;
  position: fixed;
  z-index: 1000;
  left: 50%;              /* Ø¶Ø¹ Ø§Ù„Ø¹Ù†ØµØ± ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø¹Ø±Ø¶ */
  top: 20px;              /* Ø§Ø¬Ø¹Ù„Ù‡ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
  transform: translateX(-50%) translateY(-20px); /* Ø¶Ø¨Ø· Ø§Ù„ØªÙˆØ³ÙŠØ· */
  font-size: 15px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  opacity: 0;
  transition: opacity 0.5s, transform 0.5s;
}

.toast.show {
  visibility: visible;
  opacity: 1;
  transform: translateX(-50%) translateY(0); /* Ø¥Ø±Ø¬Ø§Ø¹Ù‡ Ù„Ù…ÙƒØ§Ù†Ù‡ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ */
}

/* âœ… Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 1001;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #fff8e1;
  padding: 25px;
  border-radius: 20px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  max-width: 400px;
}
.modal-content h2 {
  margin-top: 0;
  color: #6d4c41;
}
.modal-actions {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 15px;
}
.modal-actions button {
  padding: 10px 20px;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
}
.remove-btn-modal {
  background: linear-gradient(90deg, #c62828, #e53935);
  color: #fff;
}
.remove-btn-modal:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(183,28,28,0.5);
  background: linear-gradient(90deg, #b71c1c, #d32f2f);
}
#confirmNo {
  background: linear-gradient(90deg, #6d4c41, #8d6e63);
  color: #fff;
}
#confirmNo:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(93,64,55,0.5);
  background: linear-gradient(90deg, #4e342e, #6d4c41);
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨ */
.call-btn, .whatsapp-btn {
  display: inline-block;
  padding: 8px 16px;
  font-size: 15px;
  font-weight: bold;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  margin-left: 10px;
  text-decoration: none;
  color: #fff;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
}
.call-btn {
  background: linear-gradient(90deg, #388e3c, #4caf50);
}
.call-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 10px 30px rgba(56,142,60,0.6);
  background: linear-gradient(90deg, #2e7d32, #388e3c);
}
.whatsapp-btn {
  background: linear-gradient(90deg, #1ebea5, #25d366);
}
.whatsapp-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 10px 30px rgba(30,190,165,0.6);
  background: linear-gradient(90deg, #128c7e, #1ebea5);
}
/* Ø³ØªØ§ÙŠÙ„ ÙØ§Ø®Ø± Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ù‡Ø§ØªÙ */
button, .call-btn, .whatsapp-btn {
  position: relative;
  overflow: hidden; /* Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø±ÙØ¨Ù„ */
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· (active) */
button:active, .call-btn:active, .whatsapp-btn:active {
  transform: scale(0.95); /* ØªØµØºÙŠØ± Ø¨Ø³ÙŠØ· */
  box-shadow: 0 0 25px rgba(255,255,255,0.6); /* ØªÙˆÙ‡Ø¬ ÙØ§Ø®Ø± */
}

/* Ripple Effect */
button::after, .call-btn::after, .whatsapp-btn::after {
  content: "";
  position: absolute;
  background: rgba(255,255,255,0.4);
  border-radius: 50%;
  width: 100px;
  height: 100px;
  transform: scale(0);
  opacity: 0;
  pointer-events: none;
  animation: none;
}

button:active::after, .call-btn:active::after, .whatsapp-btn:active::after {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
  animation: ripple 0.6s ease-out;
}
/* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ùˆ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
button, a {
  -webkit-tap-highlight-color: transparent; /* Ù„Ù…ØªØµÙØ­Ø§Øª WebKit (Chrome, Safari, Android) */
  -webkit-focus-ring-color: transparent;    /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø§ÙØ© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
  outline: none;                            /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ */
}

/* Ø­Ø±ÙƒØ© Ø§Ù„Ø±ÙØ¨Ù„ */
@keyframes ripple {
  from {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0.8;
  }
  to {
    transform: translate(-50%, -50%) scale(2.5);
    opacity: 0;
  }
}
/* Ù…Ø¤Ø«Ø±Ø§Øª */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>
  <header>
    <h1>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h1>
  </header>

  <main>
    <div id="orderDetails">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    <div style="text-align:center;">
      <button class="back-btn" onclick="window.location.href='orders.html'">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      <button class="remove-btn" onclick="deleteOrder()">ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </main>

  <!-- âœ… Toast -->
  <div id="toast" class="toast"></div>

  <!-- âœ… Modal -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h2>âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h2>
      <p id="confirmMessage">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ</p>
      <div class="modal-actions">
        <button class="remove-btn-modal" id="confirmYes">Ù†Ø¹Ù…</button>
        <button id="confirmNo">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <script>
    let orderId = null;

    // âœ… ØªÙ†Ø³ÙŠÙ‚ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ© ØµØ­ÙŠØ­Ø© (Ù…Ø«Ø§Ù„: Ø§Ù„Ù…ØºØ±Ø¨ 212)
    function formatWhatsAppNumber(phone) {
      let cleaned = phone.replace(/\D/g, "");
      if (cleaned.startsWith("0")) {
        cleaned = "212" + cleaned.substring(1);
      }
      return cleaned;
    }

    // âœ… Toast
    function showToast(message, type="success") {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.background = type === "success"
        ? "linear-gradient(90deg, #4caf50, #2e7d32)"
        : "linear-gradient(90deg, #f44336, #b71c1c)";
      toast.className = "toast show";
      setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
    }

    // âœ… Modal
    function showConfirm(message, onConfirm) {
      const modal = document.getElementById("confirmModal");
      const msg = document.getElementById("confirmMessage");
      msg.textContent = message;
      modal.style.display = "flex";

      document.getElementById("confirmYes").onclick = () => {
        modal.style.display = "none";
        onConfirm();
      };
      document.getElementById("confirmNo").onclick = () => {
        modal.style.display = "none";
      };
    }

    function getOrderIdFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get("id");
    }

    async function loadOrderDetails() {
      orderId = getOrderIdFromURL();
      if (!orderId) {
        document.getElementById("orderDetails").innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨.";
        return;
      }

      try {
        const docRef = await db.collection("orders").doc(orderId).get();
        if (!docRef.exists) {
          document.getElementById("orderDetails").innerHTML = "âŒ Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.";
          return;
        }

        const order = docRef.data();
        let productsHtml = `<div class="product-list">`;
        let totalPrice = 0;
        let productsText = "";

        order.items.forEach(item => {
          totalPrice += parseFloat(item.price) || 0;
          productsHtml += `
            <div class="product-item">
              <img src="${item.imageUrl || 'assets/products-img/no-image.png'}" alt="${item.name}">
              <p>${item.name}</p>
              <p>ğŸ’µ ${item.price} DH</p>
            </div>
          `;
          productsText += `- ${item.name} (${item.price} DH)\n`;
        });
        productsHtml += `</div>`;
        productsHtml += `<div class="total-price">ğŸ”¢ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${totalPrice} DH</div>`;

        const whatsappNumber = formatWhatsAppNumber(order.phone);

        // âœ… Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
        const whatsappMessage = encodeURIComponent(
          `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${order.name} ğŸ‘‹\n\n` +
          `Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒ Ø¨Ù†Ø§ ÙˆØ·Ù„Ø¨Ùƒ ğŸ™\n\n` +
          `ğŸ“¦ ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ùƒ:\n${productsText}\n` +
          `ğŸ’µ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${totalPrice} DH\n\n` +
          `Ù‡Ù„ ØªØ¤ÙƒØ¯ Ø·Ù„Ø¨ÙƒØŸ âœ…`
        );

        document.getElementById("orderDetails").innerHTML = `
          <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${order.name}</p>
          <p>ğŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${order.city}</p>
          <p>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${order.address}</p>
          <p>
            ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${order.phone}
            <a href="tel:${order.phone}" class="call-btn">ğŸ“² Ø§ØªØµØ§Ù„</a>
            <a href="https://wa.me/${whatsappNumber}?text=${whatsappMessage}" 
               target="_blank" class="whatsapp-btn">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
          </p>
          <h3>ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</h3>
          ${productsHtml}
        `;

        // âœ… Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        if (!order.opened) {
          showToast("ğŸ“¢ Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!", "success");
          await db.collection("orders").doc(orderId).update({ opened: true });
        }

      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:", error);
        showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨", "error");
      }
    }

    async function deleteOrder() {
      showConfirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ", async () => {
        try {
          await db.collection("orders").doc(orderId).delete();
          showToast("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
          setTimeout(() => { window.location.href = "orders.html"; }, 1500);
        } catch (error) {
          console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨:", error);
          showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨", "error");
        }
      });
    }

    // âœ… ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    loadOrderDetails();
  </script>
</body>
</html>